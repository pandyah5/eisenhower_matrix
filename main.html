<!DOCTYPE html>
<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.js"> </script> <!-- Importing Chart.js for plotting matrices -->

<script>

// The variable to store the urgency and importance points
let data = new Map();

// Function to add the task item supplied by the user
function add_item () {
	let taskname = document.getElementById("taskname").value;
	document.getElementById("To_do_list").innerHTML += ('<li id="'+ taskname +'">' + taskname);
	document.getElementById("To_do_list").innerHTML += ('<button id="btn_'+taskname+'" type="button" onclick="delete_item(\'' + taskname + '\')">X</button> </li>');
	
	// Add the task to the data hashmap
	let urgency = document.getElementById("urgency").value;
	let importance = document.getElementById("importance").value;
	let scatter_point = {x: urgency, y: importance};
	data.set(taskname, scatter_point);
	
	// For debug let us print all elements of data
	for (const [key, value] of data) {
		console.log(key + " is mapped to: " + value.x + ", " + value.y);
	}
	
	// Update the eisenhower matrix
	plot_eisenhower_matrix();

	return;
}

// Function to delete the task item when the "X" button is clicked
function delete_item(taskname) {
	// Debug statement for the browser
	console.log("Trying to delete: " + taskname);
	
	// Delete the text entry
	let elem = document.getElementById(taskname);
	elem.parentNode.removeChild(elem);

	// Delete the "X" button associated with it
	document.getElementById("btn_" + taskname).remove();
	
	// Delete the entry from the data hashmap
	data.delete(taskname);
	
	// Update the eisenhower matrix
	plot_eisenhower_matrix();

	return;
}

function plot_eisenhower_matrix() {
	// Extract the plot points and labels from data
	let plot_data = [];
	let plot_labels = [];
	for (const[key, value] of data) {
		plot_labels.push(key);
		plot_data.push(value);
	}
	
	// For debug let us print all labels
	for (const key of plot_labels) {
		console.log("Label: " + key);
	}

	// Configure the chart
	const myChart = new Chart("matrix", {
	  type: "scatter",
	  data: {
			labels: plot_labels,
			datasets: [{
				pointRadius: 4,
				pointBackgroundColor: "rgba(0,0,255,1)",
				label: 'Legend',
				data: plot_data
			}]
		},
	  options: {
			tooltips: {
				callbacks: {
					label: function(tooltipItem, data) {
					   var label = data.labels[tooltipItem.index];
					   return label + ': (' + tooltipItem.xLabel + ', ' + tooltipItem.yLabel + ')';
					}
				}
			},
			title: {
				display: true,
				text: 'Eisenhower Matrix'
			},
			scales: {
				yAxes: [{
					ticks: {
						max: 5,
						min: -5
					}
				}],
				xAxes: [{
					ticks: {
						max: 5,
						min: -5
					}
				}]
			},
			elements: {
				point: {
					pointStyle: 'circle'
				}
			}
		}
	});
}

</script>
</head>


<body>
<h1> This is an Eisenhower inspired to-do list! </h1>

<!-- Get the taskname -->
<label for="taskname">Item:</label>
<input type="text" value = "e.g. Water the plants" id="taskname" name="taskname" minlength="1" maxlength="20" required>

<!-- Get the urgency -->
<label for="urgency">Urgency:</label>
<input type="number" id="urgency" name="urgency" minlength="1" maxlength="20" required>

<!-- Get the importance -->
<label for="importance">Importance:</label>
<input type="number" id="importance" name="importance" minlength="1" maxlength="20" required>

<button type="button" onclick="add_item()">Add item!</button>

<p> Your to-do list: </p> 
<ul id="To_do_list">
</ul>

<div id="einsenhower">
	<canvas id="matrix" style="width:100%;max-width:700px"></canvas>
</div> 

<p id="credits"> Created by your beloved HP </p>
</body>
</html>